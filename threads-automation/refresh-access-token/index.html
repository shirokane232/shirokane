<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>白金雜記</title><style>.hide-scrollbar[data-v-c57d00f0]::-webkit-scrollbar{display:none}.hide-scrollbar[data-v-c57d00f0]{-ms-overflow-style:none;scrollbar-width:none}</style><style>/*! tailwindcss v4.1.11 | MIT License | https://tailwindcss.com */@layer properties{@supports ((-webkit-hyphens:none) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){[data-v-a539c6c2],[data-v-a539c6c2]::backdrop,[data-v-a539c6c2]:after,[data-v-a539c6c2]:before{--tw-leading:initial;--tw-duration:initial;--tw-font-weight:initial;--tw-space-y-reverse:0;--tw-border-style:solid}}}.markdown[data-v-a539c6c2]{--tw-leading:var(--leading-relaxed,1.625);color:var(--foreground);line-height:var(--leading-relaxed,1.625)}.markdown[data-v-a539c6c2] *{padding:calc(var(--spacing,.25rem)*1);transition-duration:var(--tw-duration,var(--default-transition-duration,.15s));transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function,cubic-bezier(.4,0,.2,1)));--tw-duration:.2s;transition-duration:.2s}@media (hover:hover){.markdown[data-v-a539c6c2] :hover{background-color:var(--foreground);border-radius:var(--radius-xs,.125rem)}@supports (color:color-mix(in lab,red,red)){.markdown[data-v-a539c6c2] :hover{background-color:color-mix(in oklab,var(--foreground)10%,transparent)}}}.markdown h1[data-v-a539c6c2]{font-size:var(--text-3xl,1.875rem);line-height:var(--tw-leading,var(--text-3xl--line-height,1.2));margin-bottom:calc(var(--spacing,.25rem)*6);--tw-font-weight:var(--font-weight-bold,700);font-weight:var(--font-weight-bold,700)}.markdown h2[data-v-a539c6c2]{font-size:var(--text-2xl,1.5rem);line-height:var(--tw-leading,var(--text-2xl--line-height,1.33333));margin-bottom:calc(var(--spacing,.25rem)*4);margin-top:calc(var(--spacing,.25rem)*8)}.markdown h2[data-v-a539c6c2],.markdown h3[data-v-a539c6c2]{--tw-font-weight:var(--font-weight-semibold,600);font-weight:var(--font-weight-semibold,600)}.markdown h3[data-v-a539c6c2]{font-size:var(--text-xl,1.25rem);line-height:var(--tw-leading,var(--text-xl--line-height,1.4));margin-bottom:calc(var(--spacing,.25rem)*3);margin-top:calc(var(--spacing,.25rem)*6)}.markdown p[data-v-a539c6c2]{font-size:var(--text-base,1rem);line-height:var(--tw-leading,var(--text-base--line-height,1.5));margin-bottom:calc(var(--spacing,.25rem)*4)}.markdown a[data-v-a539c6c2]{color:var(--primary);text-decoration-line:underline}@media (hover:hover){.markdown a[data-v-a539c6c2]:hover{color:var(--primary)}@supports (color:color-mix(in lab,red,red)){.markdown a[data-v-a539c6c2]:hover{color:color-mix(in oklab,var(--primary)80%,transparent)}}}.markdown hr[data-v-a539c6c2]{border-color:var(--border);margin-block:calc(var(--spacing,.25rem)*6)}.markdown ol[data-v-a539c6c2]{list-style-type:decimal;margin-bottom:calc(var(--spacing,.25rem)*4)}:where(.markdown ol[data-v-a539c6c2]>:not(:last-child)){--tw-space-y-reverse:0;margin-block-end:calc(var(--spacing,.25rem)*2*(1 - var(--tw-space-y-reverse)));margin-block-start:calc(var(--spacing,.25rem)*2*var(--tw-space-y-reverse))}.markdown ol[data-v-a539c6c2]{padding-left:calc(var(--spacing,.25rem)*6)}.markdown ul[data-v-a539c6c2]{list-style-type:disc;margin-bottom:calc(var(--spacing,.25rem)*4)}:where(.markdown ul[data-v-a539c6c2]>:not(:last-child)){--tw-space-y-reverse:0;margin-block-end:calc(var(--spacing,.25rem)*2*(1 - var(--tw-space-y-reverse)));margin-block-start:calc(var(--spacing,.25rem)*2*var(--tw-space-y-reverse))}.markdown ul[data-v-a539c6c2]{padding-left:calc(var(--spacing,.25rem)*6)}.markdown li[data-v-a539c6c2]{--tw-leading:var(--leading-relaxed,1.625);line-height:var(--leading-relaxed,1.625)}.markdown code[data-v-a539c6c2]{padding-block:calc(var(--spacing,.25rem)*.5);padding-inline:calc(var(--spacing,.25rem)*0)}.markdown code[data-v-a539c6c2],.markdown pre[data-v-a539c6c2]{background-color:var(--muted);border-radius:.25rem;color:var(--foreground);font-family:var(--font-mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace);font-size:var(--text-sm,.875rem);line-height:var(--tw-leading,var(--text-sm--line-height,1.42857))}.markdown pre[data-v-a539c6c2]{margin-bottom:calc(var(--spacing,.25rem)*4);overflow-x:auto;padding:calc(var(--spacing,.25rem)*4)}.markdown blockquote[data-v-a539c6c2]{border-color:var(--border);border-left-style:var(--tw-border-style);border-left-width:4px;color:var(--muted-foreground);font-style:italic;padding-left:calc(var(--spacing,.25rem)*4)}@property --tw-leading{syntax:"*";inherits:false}@property --tw-duration{syntax:"*";inherits:false}@property --tw-font-weight{syntax:"*";inherits:false}@property --tw-space-y-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}</style><link rel="stylesheet" href="/shirokane/assets/entry.FHsB_9tz.css" crossorigin><style>@layer base {:where(.i-gg\:menu-round){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cg fill='black'%3E%3Cpath d='M8 6.983a1 1 0 1 0 0 2h8a1 1 0 1 0 0-2zM7 12a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2H8a1 1 0 0 1-1-1m1 3.017a1 1 0 1 0 0 2h8a1 1 0 1 0 0-2z'/%3E%3Cpath fill-rule='evenodd' d='M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10m-2 0a8 8 0 1 1-16 0a8 8 0 0 1 16 0' clip-rule='evenodd'/%3E%3C/g%3E%3C/svg%3E")}:where(.i-material-symbols-light\:chevron-right-rounded){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='black' d='M13.292 12L9.046 7.754q-.14-.14-.15-.344t.15-.364t.354-.16t.354.16l4.388 4.389q.131.13.184.267t.053.298t-.053.298t-.184.268l-4.388 4.388q-.14.14-.344.15t-.364-.15t-.16-.354t.16-.354z'/%3E%3C/svg%3E")}:where(.i-mdi\:share-variant){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='black' d='M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3a3 3 0 0 0-3-3a3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3a3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66c0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08'/%3E%3C/svg%3E")}:where(.i-uil\:arrow-up-right){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='black' d='M17.92 6.62a1 1 0 0 0-.54-.54A1 1 0 0 0 17 6H7a1 1 0 0 0 0 2h7.59l-8.3 8.29a1 1 0 0 0 0 1.42a1 1 0 0 0 1.42 0L16 9.41V17a1 1 0 0 0 2 0V7a1 1 0 0 0-.08-.38'/%3E%3C/svg%3E")}}</style><link rel="preload" as="fetch" crossorigin="anonymous" href="/shirokane/threads-automation/refresh-access-token/_payload.json?e5a42deb-fb42-483c-97a9-4101b735b65f"><link rel="modulepreload" as="script" crossorigin href="/shirokane/assets/yIv7Uklc.js"><link rel="modulepreload" as="script" crossorigin href="/shirokane/assets/BBZ1cm6X.js"><link rel="modulepreload" as="script" crossorigin href="/shirokane/assets/DakNi5gz.js"><link rel="modulepreload" as="script" crossorigin href="/shirokane/assets/CW2TFZOr.js"><link rel="modulepreload" as="script" crossorigin href="/shirokane/assets/DlAUqK2U.js"><link rel="modulepreload" as="script" crossorigin href="/shirokane/assets/DaDXZlMW.js"><link rel="preload" as="fetch" fetchpriority="low" crossorigin="anonymous" href="/shirokane/assets/builds/meta/e5a42deb-fb42-483c-97a9-4101b735b65f.json"><link rel="prefetch" as="script" crossorigin href="/shirokane/assets/Hq3Dn0FT.js"><link rel="prefetch" as="script" crossorigin href="/shirokane/assets/xf0mpAgv.js"><link rel="prefetch" as="script" crossorigin href="/shirokane/assets/DyvgcUgI.js"><meta name="description" content="數位乞丐｜免費服務狂熱者"><meta property="og:title" content="白金雜記"><meta property="og:description" content="數位乞丐｜免費服務狂熱者"><meta property="og:type" content="website"><meta property="og:url" content="https://shirokane232.github.io/shirokane/"><link rel="icon" type="image/x-icon" href="/shirokane/favicon.ico"><script type="module" src="/shirokane/assets/yIv7Uklc.js" crossorigin></script><script id="unhead:payload" type="application/json">{"title":"白金雜記"}</script><script>"use strict";(()=>{const t=window,e=document.documentElement,c=["dark","light"],n=getStorageValue("localStorage","nuxt-color-mode")||"dark";let i=n==="system"?u():n;const r=e.getAttribute("data-color-mode-forced");r&&(i=r),l(i),t["__NUXT_COLOR_MODE__"]={preference:n,value:i,getColorScheme:u,addColorScheme:l,removeColorScheme:d};function l(o){const s=""+o+"",a="";e.classList?e.classList.add(s):e.className+=" "+s,a&&e.setAttribute("data-"+a,o)}function d(o){const s=""+o+"",a="";e.classList?e.classList.remove(s):e.className=e.className.replace(new RegExp(s,"g"),""),a&&e.removeAttribute("data-"+a)}function f(o){return t.matchMedia("(prefers-color-scheme"+o+")")}function u(){if(t.matchMedia&&f("").media!=="not all"){for(const o of c)if(f(":"+o).matches)return o}return"dark"}})();function getStorageValue(t,e){switch(t){case"localStorage":return window.localStorage.getItem(e);case"sessionStorage":return window.sessionStorage.getItem(e);case"cookie":return getCookie(e);default:return null}}function getCookie(t){const c=("; "+window.document.cookie).split("; "+t+"=");if(c.length===2)return c.pop()?.split(";").shift()}</script></head><body><div id="__nuxt"><div class="flex min-h-screen flex-col" data-v-c57d00f0><header class="sticky top-0 z-50 flex h-16 max-h-16 min-h-16 items-center justify-center border-b border-dashed" data-v-c57d00f0><div class="grid h-full w-full max-w-[1400px] grid-cols-[auto_1fr_auto] items-center justify-center gap-6 border-x border-dashed px-4 xl:max-w-[calc(100vw-128px)]" data-v-c57d00f0><div class="flex cursor-pointer items-center justify-center gap-3" data-v-c57d00f0><span class="iconify i-gg:menu-round mt-1 h-8 w-8" aria-hidden="true" style="" data-v-c57d00f0></span><h1 class="font-serif text-3xl font-semibold" data-v-c57d00f0>白金雜記</h1></div><div data-v-c57d00f0></div><div data-v-c57d00f0><button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#39;size-&#39;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-9 px-4 py-2 has-[&gt;svg]:px-3" data-v-c57d00f0><!--[--><span class="iconify i-mdi:share-variant" aria-hidden="true" style="" data-v-c57d00f0></span> <!--]--></button></div></div></header><div class="flex h-[calc(100vh-4rem)] justify-center" data-v-c57d00f0><div class="flex w-full max-w-[1400px] border-x border-dashed xl:max-w-[calc(100vw-128px)]" data-v-c57d00f0><aside class="hidden hide-scrollbar w-full overflow-y-auto border-r border-dashed" data-v-c57d00f0><div class="w-full space-y-3 p-4" data-v-c57d00f0><!--[--><div class="space-y-4" data-v-c57d00f0><div class="w-full"><div class="flex cursor-pointer items-center justify-between py-2 font-bold"><div class="flex items-center gap-2"><div>免費服務筆記</div></div><span class="iconify i-material-symbols-light:chevron-right-rounded" aria-hidden="true" style=""></span></div><div class="overflow-hidden"><div class="hidden"><!--[--><a href="/shirokane/free-tier-services/cloudflare-nuxt-backend"><div class="hover:bg-accent/80 cursor-pointer rounded px-2 py-1">Cloudflare 後端 (Nuxt)</div></a><!--]--></div></div></div></div><div class="space-y-4" data-v-c57d00f0><div class="w-full"><div class="flex cursor-pointer items-center justify-between py-2 font-bold"><div class="flex items-center gap-2"><div>Threads 自動化</div></div><span class="iconify i-material-symbols-light:chevron-right-rounded rotate-90" aria-hidden="true" style=""></span></div><div class="overflow-hidden"><div class=""><!--[--><a href="/shirokane/threads-automation/access-threads-api"><div class="hover:bg-accent/80 cursor-pointer rounded px-2 py-1">Threads API 服務開通</div></a><a href="/shirokane/threads-automation/refresh-access-token"><div class="bg-accent hover:bg-accent/80 cursor-pointer rounded px-2 py-1">更新 Access Token</div></a><!--]--></div></div></div></div><div class="space-y-4" data-v-c57d00f0><div class="w-full"><div class="flex cursor-pointer items-center justify-between py-2 font-bold"><div class="flex items-center gap-2"><div>關於</div></div><span class="iconify i-material-symbols-light:chevron-right-rounded" aria-hidden="true" style=""></span></div><div class="overflow-hidden"><div class="hidden"><!--[--><a href="/shirokane/about/shirokane"><div class="hover:bg-accent/80 cursor-pointer rounded px-2 py-1">白金雜記</div></a><!--]--></div></div></div></div><!--]--></div></aside><main class="hide-scrollbar flex-1 overflow-y-auto" data-v-c57d00f0><div class="markdown flex1 space-y-6 p-6" data-v-c57d00f0><!--[--><!--[--><h1 data-v-a539c6c2>Threads 自動刷新 Token</h1><hr data-v-a539c6c2><h3 data-v-a539c6c2>快速總結：</h3><ul data-v-a539c6c2><li data-v-a539c6c2> 由於 Threads API 的 Access Token 會過期，我們使用 Google Apps Script 建立了一個自動化的腳本，來定期更新這些 Token，確保服務能夠持續穩定運行。 </li></ul><hr data-v-a539c6c2><h3 data-v-a539c6c2>Step 1: 設置 Google Apps Script</h3><p data-v-a539c6c2>我用 Google Sheets 當成我的資料庫，用Google Apps Script 加上定時觸發來完成這個流程。</p><ul data-v-a539c6c2><li data-v-a539c6c2> 創建一個 Google sheets，拉一個表並命名為<code data-v-a539c6c2>secrets</code>如下圖： <img src="/shirokane/markdown/threads-automation/refresh-access-token/578b8209-b9bb-4ca3-ba34-d5976d954ef9.png" alt="Default Sheet" data-v-a539c6c2></li><li data-v-a539c6c2> 開啟Apps Script：擴充功能 -&gt; Apps Script <ul data-v-a539c6c2><li data-v-a539c6c2> 創建sheets.gs，內容從<a href="https://github.com/shirokane232/google-app-script/blob/main/sheets.js" rel="noopener noreferrer" target="_blank" data-v-a539c6c2>這裡<span data-v-a539c6c2><span class="iconify i-uil:arrow-up-right" aria-hidden="true" style="" data-v-a539c6c2></span></span></a>複製貼上。 </li><li data-v-a539c6c2> 創建main.gs，內容如下： <pre data-v-a539c6c2><code data-v-a539c6c2>function main() {
   console.log(readRows(&quot;secrets&quot;))
}
</code></pre></li><li data-v-a539c6c2> 存檔後選擇 main 按下執行，這一步會跳出一些授權的畫面，全部同意。 <img src="/shirokane/markdown/threads-automation/refresh-access-token/09f27448-f72d-401c-9791-e2fe395b5e08.png" alt="Execute Sheet" data-v-a539c6c2></li><li data-v-a539c6c2> 將secrets sheet第一列的設置如下： <ul data-v-a539c6c2><li data-v-a539c6c2>id: <code data-v-a539c6c2>threads-user</code></li><li data-v-a539c6c2> secrets: 從上一篇 threads user access token 的 response，樣子像是 {&quot;access_token&quot;:&quot;...&quot;,&quot;user_id&quot;:&quot;...&quot;} </li><li data-v-a539c6c2>updatedAt: 0</li></ul></li></ul></li></ul><h3 data-v-a539c6c2>Step 2: 在 Cloudflare 上部署一個服務來刷新 Token</h3><p data-v-a539c6c2> Threads API 授權流程需要一個長效的Token。Cloudflare 是一個快速且免費的託管平台，非常適合用來處理這個登入流程。 </p><ul data-v-a539c6c2><li data-v-a539c6c2><p data-v-a539c6c2> 參考<a href="/shirokane/threads-automation/access-threads-api" data-v-a539c6c2>上一篇</a>的 deployment 流程，將response貼在secrets column裡面 </p></li><li data-v-a539c6c2><p data-v-a539c6c2> 由於App Script用來送request的<code data-v-a539c6c2>UrlFetchApp</code>不接受太長的URL，於是我們使用一個proxy endpoint幫忙轉向： </p><pre data-v-a539c6c2><code data-v-a539c6c2>// /server/api/threads/refresh.ts
import { defineEventHandler, readBody } from &quot;h3&quot;;

export default defineEventHandler(async (event) =&gt; {
  const { access_token, user_id } = await readBody(event);
  if (!access_token || !user_id) {
    return { success: false, error: &quot;Missing access_token or user_id.&quot; };
  }

  const params = new URLSearchParams();
  params.append(&quot;grant_type&quot;, &quot;th_refresh_token&quot;);
  params.append(&quot;access_token&quot;, access_token);

  const requestUrl = `https://graph.threads.net/refresh_access_token?${params.toString()}`;

  try {
    const response = await fetch(requestUrl, {
      method: &quot;GET&quot;,
    });

    const refreshedTokenData = await response.json();

    if (!response.ok) {
      return {
        success: false,
        error: refreshedTokenData.error_message || &quot;Failed to refresh token.&quot;,
      };
    }

    return {
      access_token: refreshedTokenData.access_token,
      user_id: user_id,
    };
  } catch (err) {
    return { success: false, error: &quot;Network request failed.&quot; };
  }
});
</code></pre></li><li data-v-a539c6c2><p data-v-a539c6c2> 參考用實作<a href="https://github.com/shirokane232/cf/blob/main/server/api/threads/auth/refresh-token.ts" rel="noopener noreferrer" target="_blank" data-v-a539c6c2>連結<span data-v-a539c6c2><span class="iconify i-uil:arrow-up-right" aria-hidden="true" style="" data-v-a539c6c2></span></span></a>。 </p></li></ul><hr data-v-a539c6c2><h3 data-v-a539c6c2>Step 3: 使用 Google Apps Script 自動更新 Token</h3><p data-v-a539c6c2> Threads 的 Token 會過期，因此你需要一個定時任務來自動刷新它。Google Apps Script 是個免費且可靠的選擇，可以設定定時觸發器。 </p><ul data-v-a539c6c2><li data-v-a539c6c2><p data-v-a539c6c2>在 Google Apps Script 貼上參考用的 scripts:</p><ul data-v-a539c6c2><li data-v-a539c6c2> 用來操作sheet跟record更新的<a href="https://github.com/shirokane232/google-app-script/blob/main/sheets.js" rel="noopener noreferrer" target="_blank" data-v-a539c6c2>sheet.js<span data-v-a539c6c2><span class="iconify i-uil:arrow-up-right" aria-hidden="true" style="" data-v-a539c6c2></span></span></a></li><li data-v-a539c6c2> 用來操作threads相關內容的<a href="https://github.com/shirokane232/google-app-script/blob/main/threads.js" rel="noopener noreferrer" target="_blank" data-v-a539c6c2>threads.js<span data-v-a539c6c2><span class="iconify i-uil:arrow-up-right" aria-hidden="true" style="" data-v-a539c6c2></span></span></a></li></ul></li><li data-v-a539c6c2><p data-v-a539c6c2>主要刷新用的 function refreshToken()，一些小細節分享：</p><ul data-v-a539c6c2><li data-v-a539c6c2>domain可以改成你的Cloudflare service domain:</li><li data-v-a539c6c2>目前設定是8小時更新一次，最後一次更新時間會寫回<code data-v-a539c6c2>updatedAt</code></li><li data-v-a539c6c2>得到新的token會寫回<code data-v-a539c6c2>secrets</code></li></ul><pre data-v-a539c6c2><code data-v-a539c6c2>function refreshToken() {
  const domain = loadEnv()[&quot;CLOUDFLARE&quot;];
  const threadSecrets = readRows(&quot;secrets&quot;).find((value) =&gt; {
    return value[&quot;id&quot;] == &quot;threads-user&quot;;
  });
  const now = new Date().getTime();
  const eightHoursInMilliseconds = 8 * 60 * 60 * 1000;
  if (now - threadSecrets.updatedAt &gt; eightHoursInMilliseconds) {
    const options = {
      method: &quot;post&quot;,
      contentType: &quot;application/json&quot;,
      payload: JSON.stringify(JSON.parse(threadSecrets.secrets)),
    };
    const url = `${domain}api/threads/auth/refresh-token`;
    try {
      const response = UrlFetchApp.fetch(url, options);
      const responseContent = response.getContentText();
      const responseData = JSON.parse(responseContent);
      const responseCode = response.getResponseCode();
      if (responseCode === 200) {
        console.log(JSON.stringify(responseData));
        threadSecrets.secrets = JSON.stringify(responseData);
        threadSecrets.updatedAt = now;
        updateForRecord(&quot;secrets&quot;, threadSecrets._row_index, threadSecrets);
      }
    } catch (error) {
      console.log(error);
    }
  }
}
</code></pre></li><li data-v-a539c6c2><p data-v-a539c6c2>更新 main.gs，內容如下：</p><pre data-v-a539c6c2><code data-v-a539c6c2>function main() {
  threadMain()
}
</code></pre></li><li data-v-a539c6c2><p data-v-a539c6c2> 設定定時觸發器：在 Google Apps Script 專案的側邊欄中，點擊「觸發器」，新增一個觸發器來執行 main 函式，例如設定為15分鐘執行一次。 <img src="/shirokane/markdown/threads-automation/refresh-access-token/af137bd8-14a9-4adf-80c0-74946ba60fe6.png" alt="Trigger" data-v-a539c6c2></p></li></ul><hr data-v-a539c6c2><p data-v-a539c6c2> 透過這幾個步驟，你就建立了一個完整的自動化流程。現在，你的應用程式可以持續與 Threads API 交換 Token，而無需你頻繁手動介入。 </p><!--]--><!--]--></div><div class="flex h-16 max-h-16 min-h-16 flex-row items-center justify-center gap-6 border-t" data-v-c57d00f0><a href="/shirokane/threads-automation/access-threads-api" data-v-c57d00f0><button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#39;size-&#39;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-9 px-4 py-2 has-[&gt;svg]:px-3" data-v-c57d00f0><!--[--> Prev <!--]--></button></a><a href="/shirokane/about/shirokane" data-v-c57d00f0><button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#39;size-&#39;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-9 px-4 py-2 has-[&gt;svg]:px-3" data-v-c57d00f0><!--[--> Next <!--]--></button></a></div></main></div></div></div></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/shirokane/threads-automation/refresh-access-token/_payload.json?e5a42deb-fb42-483c-97a9-4101b735b65f">[{"state":1,"once":9,"_errors":10,"serverRendered":7,"path":12,"pinia":13,"prerenderedAt":14},["Reactive",2],{"$si18n:cached-locale-configs":3,"$si18n:resolved-locale":4,"$scolor-mode":5},{},"",{"preference":6,"value":6,"unknown":7,"forced":8},"dark",true,false,["Set"],["ShallowReactive",11],{},"/threads-automation/refresh-access-token",{},1757087848219]</script><script>window.__NUXT__={};window.__NUXT__.config={public:{i18n:{baseUrl:"",defaultLocale:"zh",rootRedirect:"",redirectStatusCode:302,skipSettingLocaleOnNavigate:false,locales:[{code:"zh",language:"zh-TW"}],detectBrowserLanguage:false,experimental:{localeDetector:"",typedPages:true,typedOptionsAndMessages:false,alternateLinkCanonicalQueries:true,devCache:false,cacheLifetime:"",stripMessagesPayload:false,preload:false,strictSeo:false,nitroContextDetection:true},domainLocales:{zh:{domain:""}}}},app:{baseURL:"/shirokane/",buildId:"e5a42deb-fb42-483c-97a9-4101b735b65f",buildAssetsDir:"assets",cdnURL:""}}</script></body></html>